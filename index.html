<!DOCTYPE html>
    <html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>米国株 テーマランキング</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=DM+Sans:wght@500;700&display=swap" rel="stylesheet">
        <style>
            :root {
                --bg-color: #ffffff;
                --border-color: #f0f0f0;
                --text-main: #222;
                --text-muted: #666;
                
                --rank-top: linear-gradient(135deg, #10b981 0%, #34d399 100%);
                --rank-normal: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                --rank-bottom: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
                
                --positive: #00875a;
                --negative: #de350b;
                
                --sp500-bg: #fffbf0;
                --sp500-border: #f59e0b;
                --sticky-bg: #fff;
                
                /* カラム幅設定 */
                --perf-col-width: 80px;      /* モバイルの数値幅 */
                --perf-col-width-pc: 70px;   /* PCの数値幅 */
            }

            * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
            
            body { 
                font-family: 'Noto Sans JP', 'DM Sans', sans-serif;
                margin: 0; padding: 0; 
                color: var(--text-main); 
                padding-bottom: 80px;
                background: var(--bg-color);
            }

            .wrapper {
                max-width: 900px;
                margin: 0 auto;
                position: relative;
            }

            /* --- ヘッダー --- */
            .sticky-header-container {
                position: sticky;
                top: 0;
                z-index: 100;
                background: rgba(255, 255, 255, 0.98);
                box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            }
            
            .header-content {
                padding: 15px 0 10px 0;
            }

            h1 {
                text-align: center;
                font-size: 1.2rem;
                margin: 0 0 12px 0;
                font-weight: 700;
                color: #111;
            }

            /* --- 期間ボタン --- */
            .period-nav {
                display: flex;
                justify-content: center;
                gap: 5px;
                padding: 0 10px 4px;
                overflow-x: auto;
                scrollbar-width: none;
            }
            .period-nav::-webkit-scrollbar { display: none; }

            .period-btn {
                padding: 7px 14px;
                border: none;
                background: linear-gradient(135deg, #e8e8e8 0%, #f5f5f5 100%);
                border-radius: 25px;
                font-size: 0.75rem;
                color: #666;
                font-weight: 600;
                white-space: nowrap;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                flex-shrink: 0;
            }
            
            .period-btn:hover:not(.active) {
                transform: translateY(-1px);
                background: linear-gradient(135deg, #ddd 0%, #e8e8e8 100%);
            }

            .period-btn.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #fff;
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
                transform: translateY(-1px);
            }

            .update-info {
                text-align: center;
                font-size: 0.65rem;
                color: #aaa;
                margin-top: 6px;
            }

            /* --- テーブル設定 --- */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                position: relative;
                margin-top: 0;
                scrollbar-width: thin;
            }
            
            table {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0;
            }

            th, td {
                padding: 12px 4px;
                border-bottom: 1px solid var(--border-color);
                vertical-align: middle;
            }

            thead th {
                background: #f8f8f8;
                font-size: 0.7rem;
                color: var(--text-muted);
                position: sticky;
                top: 0; 
                z-index: 10;
                white-space: nowrap;
                text-align: center;
                border-bottom: 2px solid #eee;
            }

            /* --- テーマ名カラム (Sticky) --- */
            .col-sticky {
                position: sticky;
                left: 0;
                background: var(--sticky-bg);
                z-index: 11;
                
                /* --- モバイル用幅設定 (強制適用) --- */
                /* 画面幅 - 80px (数値カラム1つ分) */
                width: calc(100vw - var(--perf-col-width));
                min-width: calc(100vw - var(--perf-col-width)); 
                max-width: calc(100vw - var(--perf-col-width));
                
                border-right: 1px solid #eee;
                box-shadow: 3px 0 8px rgba(0,0,0,0.03);
            }
            
            thead th.col-sticky {
                z-index: 20;
                text-align: left;
                padding-left: 16px;
                font-weight: 600;
                color: var(--text-main);
            }

            .theme-cell {
                display: flex;
                align-items: center;
                gap: 10px;
                padding-right: 8px;
            }
            
            .theme-name {
                font-size: 0.9rem;
                font-weight: 600;
                line-height: 1.4;
                white-space: normal;
                word-break: break-word;
            }

            /* --- 数値カラム --- */
            .perf-cell {
                text-align: center;
                font-family: 'DM Sans', sans-serif;
                
                /* 非選択時 (PC/Mobile共通ベース) */
                font-size: 0.7rem; /* 文字は小さく */
                font-weight: 400;
                
                width: var(--perf-col-width);
                min-width: var(--perf-col-width);
            }

            /* 選択中のカラム */
            .perf-cell.active-col, th.active-col {
                background-color: #fafafa;
            }
            
            .perf-cell.active-col {
                /* 選択中は大きく太く */
                font-weight: 700;
                font-size: 1.0rem; 
            }
            
            /* 値の色設定 (常に色は維持) */
            .val-pos { color: var(--positive); }
            .val-neg { color: var(--negative); }

            /* --- PC向けメディアクエリ (800px以上) --- */
            @media (min-width: 800px) {
                .col-sticky {
                    /* PCでは固定幅に戻す */
                    width: 380px; 
                    min-width: 380px;
                    max-width: 380px;
                    box-shadow: 1px 0 0px rgba(0,0,0,0.1);
                }
                
                .theme-name {
                    font-size: 1.0rem;
                }
                
                .perf-cell {
                    width: var(--perf-col-width-pc);
                    min-width: var(--perf-col-width-pc);
                    /* PCの非選択時は少し読みやすく */
                    font-size: 0.75rem; 
                }
                
                /* PCの選択時 */
                .perf-cell.active-col {
                    font-size: 1.05rem;
                }

                th, td {
                    padding: 10px 6px;
                }
            }

            /* ランクバッジ */
            .rank-badge {
                width: 20px;
                height: 20px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.6rem;
                font-weight: bold;
                color: white;
                background: var(--rank-normal);
                flex-shrink: 0;
            }
            .rank-top { background: var(--rank-top); box-shadow: 0 2px 5px rgba(16, 185, 129, 0.3); }
            .rank-bottom { background: var(--rank-bottom); }
            
            tr.is-sp500 td { background-color: var(--sp500-bg); }
            tr.is-sp500 .col-sticky { background-color: var(--sp500-bg); border-left: 3px solid var(--sp500-border); }

            .expand-area { padding: 24px; text-align: center; }
            .expand-btn {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: #fff;
                border: none; padding: 10px 30px; border-radius: 30px;
                font-size: 0.85rem; font-weight: 600; cursor: pointer;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }
        </style>
    </head>
    <body>

        <div class="sticky-header-container">
            <div class="wrapper header-content">
                <h1>米国株 テーマランキング</h1>
                <div class="period-nav" id="period-nav"></div>
                <div class="update-info" id="update-info"></div>
            </div>
        </div>

        <div class="wrapper">
            <div class="table-container" id="scroll-container">
                <table id="ranking-table">
                    <thead>
                        <tr id="table-header">
                            <th class="col-sticky">テーマ</th>
                            </tr>
                    </thead>
                    <tbody id="table-body">
                        </tbody>
                </table>
            </div>

            <div id="expand-area" class="expand-area" style="display:none;">
                <button class="expand-btn" onclick="expandAll()">全て表示</button>
            </div>
        </div>

        <script>
            const csvRaw = `テーマ,1日,5日,10日,3ヶ月,半年,1年
グーグル「Gemini3」「TPU」でAI覇権,0.008606431385602242,0.08184418120581505,0.11948918711331835,0.3031303871912552,0.7015631619500655,0.7160321818947755
AI利用恩恵により株価上昇,0.014622745118110014,0.012094136589298365,0.018244946230594472,0.10711279874148905,0.21868141240515726,0.2835409375345581
AI利用基盤ソフトウェア,-0.024981649454749677,0.017341058387165376,0.3237926591209874,0.457094090317532,0.7576026399954903,0.4099050034394447
エヌビディア 800V直流,0.0014999499676322525,0.03905997523446403,0.09291050001624712,0.18589240970862675,0.3800772408241717,0.25619026369533704
データセンター：光インターコネクト,0.01834911066774203,0.09018182788444573,0.14311729581380694,0.2878265344116224,0.7237846973704758,0.47003597712672796
データセンター：過剰投資懸念,-0.11135534415221038,-0.07385341154212843,-0.03151349776683021,-0.3194418529902169,-0.0029621106087581728,0.12260813266370296
OpenAI関連,-0.050147935893651074,-0.03267878406999469,-0.014981094432874653,-0.18875434168277783,0.03103839797726904,0.14372133761329553
オートメーション,0.012962008865213148,0.0318180096849785,0.06816378493387898,0.3389139304504085,0.474209392331449,0.5453902752610766
銀鉱山,0.07156512872801435,0.12444603833056989,0.16850074230688006,0.3654617727876528,0.8599461763705745,1.6297843079077001
金鉱山,0.03836182128860455,0.054547830031192346,0.040466787063299536,0.1845376839151156,0.5455715396859813,1.0485751324834167
銅鉱山,0.03058556058322104,0.06654623890777445,0.12543216741330143,0.2485787859278128,0.3856548659506298,0.33113679004263186
製薬大手,0.01060431285246155,-0.011915492791142346,-0.029701462359956743,0.14756586074034495,0.18667236924523278,0.20910472937929558
エアライン,0.007676238512153821,0.06555568026068115,0.10400437962048681,0.1722544929037675,0.46753273876029033,0.10728855581350571
データセンター電力：独立電源,0.006720938836908719,0.03129416768086135,0.0872662550902168,0.33494296403386703,0.8507176326571662,0.9028970432165786
データセンター電力：独立系発電,0.014561980619716808,-0.009950247893939501,-0.016008774816150928,0.023672527650150377,0.11424084562306058,0.16956262267242028
データセンター電力：規制下発電,0.0005361283491269742,-0.025321841328805994,-0.06780983395633322,-0.0219326990115416,0.018483841951884683,0.15829406053925577
データセンター：ストレージ,0.03178837145219071,0.14579370958301707,0.13728712317917058,0.7932869076806603,2.0408895123009945,2.3866608169457817
ネオクラウド,0.006843952634140837,-0.009418240791816301,0.0931592821133822,0.2501944778755336,1.100865467941524,0.4526540791004279
量子コンピュータ,0.02246253426285394,-0.06048057653517458,0.10194442220687971,0.24758248753477963,0.39135055905293625,0.4912842842452161
データセンター：ラック内接続,0.003874105509247938,0.04278712828023612,0.06742066254413315,0.12948401758993588,0.5354211168199916,0.4958768113632104
半導体設計ソフト・ライセンス,-0.007421413797082832,0.012266614493815053,0.08390790560379124,-0.07229975776829645,0.12979494038246897,0.05469181037352633
ハイパースケーラー カスタムAI半導体,-0.017073846967264328,0.042079420553988056,0.061352147380032473,0.19846225701604836,0.4605543904562235,0.6264476983421807
エヌビディア次世代電源アーキテクチャ,6.604947105381953e-05,0.026883128073541318,0.09625533976242195,0.02713504532028299,0.07035337149666354,-0.00172870918231538
パワー半導体：GaN,-0.0016292642644318844,-0.003795476994119751,0.08051738693464716,-0.019404701372555233,-0.09866323772237628,-0.24607441954737053
パワー半導体：SiC,0.016069580375138504,0.049596688690900725,0.20639794702444259,0.07984959024204685,0.1834247035338783,0.2892851611574603
パワー半導体：総合,0.0014999499676322525,0.013725987529520145,0.07280068208286461,0.0890993307764063,0.1290098482911073,0.19332239004666807
データセンター：サーバー受託製造,0.0070610823745183016,0.11079255013160982,0.16042857406848166,0.28435868634726047,0.9058141933789563,1.3042601275615144
データセンター：サーバーOEM,-0.021596801275751365,0.033828694547007876,0.08922931399799516,0.05870785808299339,0.31224800495376925,0.19049325132250994
ハイパースケーラー,-0.00628757115053491,0.007961582321066585,0.011208982031532644,-0.010249294278784737,0.12460371085914468,0.06302094629189336
スマートグラス,-0.005502614153184315,0.009841134610856228,0.03996290602218466,0.09260822488521714,0.27818876672423,0.367578502498368
SP500,0.002079350841514227,0.006399170798031539,0.012974489731924832,0.04810085203697967,0.14155557702267418,0.13425124239381803
`;
            const periods = ['1日', '5日', '10日', '30日', '半年', '1年'];
            let currentPeriod = '10日';
            let allData = [];
            let isExpanded = false;

            function parseCSV(text) {
                const lines = text.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                const pMap = {};
                periods.forEach(p => {
                    let idx = headers.indexOf(p);
                    if (idx === -1 && p === '30日') idx = headers.findIndex(h => h === '3ヶ月' || h === '1ヶ月');
                    pMap[p] = idx;
                });
                const data = [];
                for(let i=1; i<lines.length; i++) {
                    const row = lines[i].split(',');
                    if(row.length < 2) continue;
                    const name = row[0];
                    const isSP500 = (name === 'SP500' || name === 'S&P500');
                    const item = { name: isSP500 ? 'S&P500' : name, isSP500, raw: row };
                    periods.forEach(p => {
                        const idx = pMap[p];
                        item[p] = (idx !== -1) ? (parseFloat(row[idx]) || 0) : 0;
                    });
                    data.push(item);
                }
                return data;
            }

            function init() {
                allData = parseCSV(csvRaw);
                const nav = document.getElementById('period-nav');
                periods.forEach(p => {
                    const btn = document.createElement('button');
                    btn.className = `period-btn ${p === currentPeriod ? 'active' : ''}`;
                    btn.innerText = p;
                    btn.onclick = () => changePeriod(p);
                    nav.appendChild(btn);
                });

                const thead = document.getElementById('table-header');
                periods.forEach((p) => {
                    const th = document.createElement('th');
                    th.innerText = p;
                    th.dataset.period = p;
                    if(p === currentPeriod) th.classList.add('active-col');
                    thead.appendChild(th);
                });

                const now = new Date();
                document.getElementById('update-info').innerText = 
                    `更新: ${now.getFullYear()}/${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;

                renderTable();
                setTimeout(() => scrollToActiveColumn(false), 100);
            }

            function changePeriod(period) {
                currentPeriod = period;
                document.querySelectorAll('.period-btn').forEach(b => b.classList.toggle('active', b.innerText === period));
                document.querySelectorAll('#table-header th').forEach(th => th.classList.toggle('active-col', th.dataset.period === period));
                isExpanded = false;
                renderTable();
                scrollToActiveColumn(true);
            }

            function scrollToActiveColumn(smooth) {
                const container = document.getElementById('scroll-container');
                const headerCells = document.querySelectorAll('#table-header th');
                const stickyCell = document.querySelector('.col-sticky');
                
                let targetCell = null;
                headerCells.forEach(th => {
                    if(th.dataset.period === currentPeriod) targetCell = th;
                });

                if(targetCell && stickyCell) {
                    const stickyWidth = stickyCell.offsetWidth;
                    const targetLeft = targetCell.offsetLeft;
                    
                    // シンプルかつ強力な計算:
                    // ターゲット列の開始位置(offsetLeft)から、Sticky列の幅(stickyWidth)を引く。
                    // これにより、Sticky列のすぐ右側（可視領域の左端）にターゲット列の左端が来るようにスクロールされる。
                    // モバイルではSticky列が画面の大部分を占め、残りの隙間がターゲット列幅と一致するため、
                    // 結果として画面右端にターゲット列がピタリと収まる。
                    
                    let scrollPos = targetLeft - stickyWidth;
                    
                    if (scrollPos < 0) scrollPos = 0;

                    container.scrollTo({
                        left: scrollPos,
                        behavior: smooth ? 'smooth' : 'auto'
                    });
                }
            }

            function renderTable() {
                const tbody = document.getElementById('table-body');
                tbody.innerHTML = '';
                const sorted = [...allData].sort((a, b) => b[currentPeriod] - a[currentPeriod]);
                let displayData = sorted;
                const total = sorted.length;
                const expandArea = document.getElementById('expand-area');
                
                if(!isExpanded && total > 15) {
                    const top5 = sorted.slice(0, 5);
                    const bottom5 = sorted.slice(total - 5);
                    const visibleSet = new Set([...top5, ...bottom5]);
                    const sp500Item = sorted.find(d => d.isSP500);
                    if(sp500Item) visibleSet.add(sp500Item);
                    displayData = sorted.filter(d => visibleSet.has(d));
                    expandArea.style.display = 'block';
                } else {
                    expandArea.style.display = 'none';
                }

                displayData.forEach(item => {
                    const realIndex = sorted.indexOf(item);
                    const tr = document.createElement('tr');
                    if(item.isSP500) tr.className = 'is-sp500';
                    const tdName = document.createElement('td');
                    tdName.className = 'col-sticky';
                    let rankHtml = '';
                    if(!item.isSP500) {
                        let rClass = 'rank-badge';
                        if(realIndex < 3) rClass += ' rank-top';
                        if(realIndex >= total - 3) rClass += ' rank-bottom';
                        rankHtml = `<div class="${rClass}">${realIndex + 1}</div>`;
                    }
                    tdName.innerHTML = `<div class="theme-cell">${rankHtml}<div class="theme-name">${item.name}</div></div>`;
                    tr.appendChild(tdName);
                    periods.forEach(p => {
                        const td = document.createElement('td');
                        td.className = 'perf-cell';
                        if(p === currentPeriod) td.classList.add('active-col');
                        const val = item[p];
                        const sign = val > 0 ? '+' : '';
                        const colorClass = val >= 0 ? 'val-pos' : 'val-neg';
                        td.innerHTML = `<span class="${colorClass}">${sign}${(val * 100).toFixed(1)}%</span>`;
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
            }

            function expandAll() {
                isExpanded = true;
                renderTable();
            }

            init();
        </script>
    </body>
    </html>